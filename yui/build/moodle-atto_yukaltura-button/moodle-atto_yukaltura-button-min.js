YUI.add("moodle-atto_yukaltura-button",function(v,e){var n,u="atto_yukaltura",t="yukaltura_media",l={INPUTSUBMIT:"yukaltura_insert_btn",INPUTCANCEL:"yukaltura_cancel_btn"},r="";r='<iframe src="{{url}}" width="680px" height="580px" name="yukaltura_frame" id="yukaltura_frame_{{elementid}}"></iframe><div align="right"><input type="button" class="{{CSS.INPUTSUBMIT}}" id="{{CSS.INPUTSUBMIT}}" name="{{CSS.INPUTSUBMIT}}" value={{get_string "insert" component}}>&nbsp;<input type="button" class="{{CSS.INPUTCANCEL}}" id="{{CSS.INPUTCANCEL}}" name="{{CSS.INPUTCANCEL}}" value={{get_string "cancel" component}}></div><input type="hidden" id="select_id" name="select_id" value="">',n="",v.namespace("M.atto_yukaltura").Button=v.Base.create("button",v.M.editor_atto.EditorPlugin,[],{initializer:function(){this.get("disabled")||1==this.get("enablemymedia")&&(this.addButton({icon:"ed/selector",iconComponent:"atto_yukaltura",buttonName:"selector",title:"selector_button_title",callback:this._displaySelector,callbackArgs:"selector"}),1==this.get("enableuploading")&&(this.addButton({icon:"ed/uploader",iconComponent:"atto_yukaltura",buttonName:"uploader",title:"uploader_button_title",callback:this._displayUploader,callbackArgs:"uploader"}),1==this.get("enablerecording")&&this.addButton({icon:"ed/recorder",iconComponent:"atto_yukaltura",buttonName:"recorder",title:"recorder_button_title",callback:this._displayRecorder,callbackArgs:"recorder"})))},_getMediaControlName:function(){return this.get("host").get("elementid")+"_"+t},_displaySelector:function(e,t){var a,l,r,i,o;e.preventDefault(),a=700,l=720,(r=this.getDialogue({headerContent:M.util.get_string("form_title",u),width:a+"px",height:l+"px",focusAfterHide:t})).width!==a+"px"&&r.set("width",a+"px"),r.height!==l+"px"&&r.set("height",l+"px"),i=this._getFormContent("selectorurl"),(o=v.Node.create('<div id="selector_'+n+'" name="selector_'+n+'"></div>')).append(i),r.set("bodyContent",o),r.show(),this.markUpdated()},_displayUploader:function(e,t){var a,l,r,i,o;e.preventDefault(),a=700,l=720,(r=this.getDialogue({headerContent:M.util.get_string("form_title",u),width:a+"px",height:l+"px",focusAfterHide:t})).width!==a+"px"&&r.set("width",a+"px"),r.height!==l+"px"&&r.set("height",l+"px"),i=this._getFormContent("uploaderurl"),(o=v.Node.create('<div id="uploader_'+n+'" name="uploader_'+n+'"></div>')).append(i),r.set("bodyContent",o),r.show(),this.markUpdated()},_displayRecorder:function(e,t){var a,l,r,i,o;e.preventDefault(),a=700,l=720,(r=this.getDialogue({headerContent:M.util.get_string("form_title",u),width:a+"px",height:l+"px",focusAfterHide:t})).width!==a+"px"&&r.set("width",a+"px"),r.height!==l+"px"&&r.set("height",l+"px"),i=this._getFormContent("recorderurl"),(o=v.Node.create('<div id="recorder_'+n+'" name="recorder_'+n+'"></div>')).append(i),r.set("bodyContent",o),r.show(),this.markUpdated()},_getFormContent:function(e){var t=v.Handlebars.compile(r),a=v.Node.create(t({elementid:this.get("host").get("elementid"),CSS:l,component:u,url:this.get(e)}));return n=this.get("host").get("elementid"),this._form=a,this._form.one("."+l.INPUTSUBMIT).on("click",this._doInsert,this),this._form.one("."+l.INPUTCANCEL).on("click",this._doCancel,this),a},_doInsert:function(e){var t,a,l,r,i,o,n,u,d,s,h,c,_,p,g,m,f,y;e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),this.editor.focus(),null!==v.one("#yukaltura_select_id")&&(t=v.one("#yukaltura_select_id").get("value"),a=v.one("#yukaltura_select_name").get("value"),l=v.one("#yukaltura_host").get("value"),r=v.one("#yukaltura_partnerid").get("value"),i=v.one("#yukaltura_uiconfid").get("value"),o=v.one("#yukaltura_width").get("value"),n=v.one("#yukaltura_height").get("value"),u=v.one("#yukaltura_filetype").get("value"),d=v.one("#yukaltura_naturalwidth").get("value"),s=v.one("#yukaltura_naturalheight").get("value"),h=(new Date).getTime(),c="",null!==t&&""!==t&&null!==l&&""!==l&&null!==r&&""!==r&&null!==i&&""!==i&&null!==o&&""!==o&&null!==n&&""!==n&&("image"==u&&0<d&&0<s?(_=l+"/p/"+r+"/sp/"+r+"00/thumbnail/entry_id/",_+=t+"/def_height/"+s+"/def_width/"+d+"/type/1",g=p=0,640<d||480<s?(y=l+"/p/"+r+"/sp/"+r,y+="00/thumbnail/entry_id/"+t+"/def_height/"+(g=(f=s/480)<=(m=d/640)?(p=Math.floor(d/m),Math.floor(s/m)):(p=Math.floor(d/f),Math.floor(s/f))),c+='<a href="'+_+'" target="_new">',c+='<img src="'+(y+="/def_width/"+p+"/type/1"),c+='" width="'+p+'" height="'+g,c+='" alt="'+a+'" title="'+a+'" border="0" />',c+="</a>"):(c+='<img src="'+_,c+='" width="'+d+'" height="'+s,c+='" alt="'+a+'" title="'+a+'" border="0" />')):(c+='<iframe src="'+l+"/p/"+r+"/sp/"+r+"00/",c+="embedIframeJs/uiconf_id/"+i+"/partner_id/"+r+"?",c+="iframeembed=true&playerId=kaltura_player_"+h+"&entry_id="+t,c+='" width="'+o+'" height="'+n+'" allowfullscreen webkitallowfullscreen ',c+='mozAllowFullScreen frameborder="0" allow="encrypted-media"></iframe>'),this.get("host").insertContentAtFocusPoint(c),this.markUpdated())),this._removeParameters()},_doCancel:function(e){e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),this.editor.focus(),this._removeParameters()},_removeParameters:function(){v.all("#yukaltura_select_id").remove(),v.all("#yukaltura_select_name").remove(),v.all("#yukaltura_host").remove(),v.all("#yukaltura_partnerid").remove(),v.all("#yukaltura_uiconfid").remove(),v.all("#yukaltura_width").remove(),v.all("#yukaltura_height").remove(),v.all("#yukaltura_filetype").remove(),v.all("#yukaltura_naturalwidth").remove(),v.all("#yukaltura_naturalheight").remove()}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},selectorurl:{value:""},uploaderurl:{value:""},recorderurl:{value:""},enablemymedia:{value:0},enableuploading:{value:0},enablerecording:{value:0}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});