YUI.add("moodle-atto_yukaltura-button",function(k,e){var u,n="atto_yukaltura",t="yukaltura_media",l={INPUTSUBMIT:"yukaltura_insert_btn",INPUTCANCEL:"yukaltura_cancel_btn"},r="";r='<iframe src="{{url}}" width="680px" height="580px" name="yukaltura_frame" id="yukaltura_frame_{{elementid}}"></iframe><div align="right"><input type="button" class="{{CSS.INPUTSUBMIT}}" id="{{CSS.INPUTSUBMIT}}" name="{{CSS.INPUTSUBMIT}}" value={{get_string "insert" component}}>&nbsp;<input type="button" class="{{CSS.INPUTCANCEL}}" id="{{CSS.INPUTCANCEL}}" name="{{CSS.INPUTCANCEL}}" value={{get_string "cancel" component}}></div><input type="hidden" id="select_id" name="select_id" value="">',u="",k.namespace("M.atto_yukaltura").Button=k.Base.create("button",k.M.editor_atto.EditorPlugin,[],{initializer:function(){this.get("disabled")||1==this.get("enablemymedia")&&(this.addButton({icon:"ed/selector",iconComponent:"atto_yukaltura",buttonName:"selector",title:"selector_button_title",callback:this._displaySelector,callbackArgs:"selector"}),1==this.get("enableuploading")&&(this.addButton({icon:"ed/uploader",iconComponent:"atto_yukaltura",buttonName:"uploader",title:"uploader_button_title",callback:this._displayUploader,callbackArgs:"uploader"}),1==this.get("enablerecording")&&this.addButton({icon:"ed/recorder",iconComponent:"atto_yukaltura",buttonName:"recorder",title:"recorder_button_title",callback:this._displayRecorder,callbackArgs:"recorder"})))},_getMediaControlName:function(){return this.get("host").get("elementid")+"_"+t},_displaySelector:function(e,t){var a,l,r,i,o;e.preventDefault(),a=700,l=720,(r=this.getDialogue({headerContent:M.util.get_string("form_title",n),width:a+"px",height:l+"px",focusAfterHide:t})).width!==a+"px"&&r.set("width",a+"px"),r.height!==l+"px"&&r.set("height",l+"px"),i=this._getFormContent("selectorurl"),(o=k.Node.create('<div id="selector_'+u+'" name="selector_'+u+'"></div>')).append(i),r.set("bodyContent",o),r.show(),this.markUpdated()},_displayUploader:function(e,t){var a,l,r,i,o;e.preventDefault(),a=700,l=720,(r=this.getDialogue({headerContent:M.util.get_string("form_title",n),width:a+"px",height:l+"px",focusAfterHide:t})).width!==a+"px"&&r.set("width",a+"px"),r.height!==l+"px"&&r.set("height",l+"px"),i=this._getFormContent("uploaderurl"),(o=k.Node.create('<div id="uploader_'+u+'" name="uploader_'+u+'"></div>')).append(i),r.set("bodyContent",o),r.show(),this.markUpdated()},_displayRecorder:function(e,t){var a,l,r,i,o;e.preventDefault(),a=700,l=720,(r=this.getDialogue({headerContent:M.util.get_string("form_title",n),width:a+"px",height:l+"px",focusAfterHide:t})).width!==a+"px"&&r.set("width",a+"px"),r.height!==l+"px"&&r.set("height",l+"px"),i=this._getFormContent("recorderurl"),(o=k.Node.create('<div id="recorder_'+u+'" name="recorder_'+u+'"></div>')).append(i),r.set("bodyContent",o),r.show(),this.markUpdated()},_getFormContent:function(e){var t=k.Handlebars.compile(r),a=k.Node.create(t({elementid:this.get("host").get("elementid"),CSS:l,component:n,url:this.get(e)}));return u=this.get("host").get("elementid"),this._form=a,this._form.one("."+l.INPUTSUBMIT).on("click",this._doInsert,this),this._form.one("."+l.INPUTCANCEL).on("click",this._doCancel,this),a},_doInsert:function(e){var t,a,l,r,i,o,u,n,d,s,h,c,_,p,m,g,f,y,v;e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),this.editor.focus(),null!==k.one("#yukaltura_select_id")&&(t=k.one("#yukaltura_select_id").get("value"),a=k.one("#yukaltura_select_name").get("value"),l=k.one("#yukaltura_host").get("value"),r=k.one("#yukaltura_partnerid").get("value"),i=k.one("#yukaltura_uiconfid").get("value"),o=k.one("#yukaltura_width").get("value"),u=k.one("#yukaltura_height").get("value"),n=k.one("#yukaltura_filetype").get("value"),d=k.one("#yukaltura_naturalwidth").get("value"),s=k.one("#yukaltura_naturalheight").get("value"),h=k.one("#yukaltura_playerstudio").get("value"),c=(new Date).getTime(),_="",null!==t&&""!==t&&null!==l&&""!==l&&null!==r&&""!==r&&null!==i&&""!==i&&null!==o&&""!==o&&null!==u&&""!==u&&null!==h&&""!==h&&("image"==n&&0<d&&0<s?(p=l+"/p/"+r+"/sp/"+r+"00/thumbnail/entry_id/",p+=t+"/def_height/"+s+"/def_width/"+d+"/type/1",g=m=0,640<d||480<s?(v=l+"/p/"+r+"/sp/"+r,v+="00/thumbnail/entry_id/"+t+"/def_height/"+(g=(y=s/480)<=(f=d/640)?(m=Math.floor(d/f),Math.floor(s/f)):(m=Math.floor(d/y),Math.floor(s/y))),_+='<a href="'+p+'" target="_new">',_+='<img src="'+(v+="/def_width/"+m+"/type/1"),_+='" width="'+m+'" height="'+g,_+='" alt="'+a+'" title="'+a+'" border="0" />',_+="</a>"):(_+='<img src="'+p,_+='" width="'+d+'" height="'+s,_+='" alt="'+a+'" title="'+a+'" border="0" />')):"ovp"==h?(_+='<iframe type="text/javascript" src="'+l+"/p/"+r+"/",_+="embedPlaykitJs/uiconf_id/"+i+"?",_+="iframeembed=true&entry_id="+t+'" ',_+='style="width: '+o+"px; height: "+u+'px" ',_+='allowfullscreen webkitallowfullscreen mozAllowFullScreen frameborder="0" allow="encrypted-media">',_+="</iframe>"):(_+='<iframe src="'+l+"/p/"+r+"/sp/"+r+"00/",_+="embedIframeJs/uiconf_id/"+i+"/partner_id/"+r+"?",_+="iframeembed=true&playerId=kaltura_player_"+c+"&entry_id="+t,_+='" width="'+o+'" height="'+u+'" allowfullscreen webkitallowfullscreen ',_+='mozAllowFullScreen frameborder="0" allow="encrypted-media"></iframe>'),this.get("host").insertContentAtFocusPoint(_),this.markUpdated())),this._removeParameters()},_doCancel:function(e){e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),this.editor.focus(),this._removeParameters()},_removeParameters:function(){k.all("#yukaltura_select_id").remove(),k.all("#yukaltura_select_name").remove(),k.all("#yukaltura_host").remove(),k.all("#yukaltura_partnerid").remove(),k.all("#yukaltura_uiconfid").remove(),k.all("#yukaltura_playerstudio").remove(),k.all("#yukaltura_width").remove(),k.all("#yukaltura_height").remove(),k.all("#yukaltura_filetype").remove(),k.all("#yukaltura_naturalwidth").remove(),k.all("#yukaltura_naturalheight").remove()}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},selectorurl:{
value:""},uploaderurl:{value:""},recorderurl:{value:""},enablemymedia:{value:0},enableuploading:{value:0},enablerecording:{value:0}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});