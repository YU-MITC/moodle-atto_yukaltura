YUI.add("moodle-atto_yukaltura-button",function(f,e){var l="atto_yukaltura",a={INPUTSUBMIT:"yukaltura_insert_btn",INPUTCANCEL:"yukaltura_cancel_btn"},r="";f.namespace("M.atto_yukaltura").Button=f.Base.create("button",f.M.editor_atto.EditorPlugin,[],{initializer:function(){this.get("disabled")||1==this.get("enablemymedia")&&(this.addButton({icon:"ed/selector",iconComponent:"atto_yukaltura",buttonName:"selector",title:"selector_button_title",callback:this._displaySelector,callbackArgs:"selector"}),1==this.get("enableuploading")&&(this.addButton({icon:"ed/uploader",iconComponent:"atto_yukaltura",buttonName:"uploader",title:"uploader_button_title",callback:this._displayUploader,callbackArgs:"uploader"}),1==this.get("enablerecording")&&this.addButton({icon:"ed/recorder",iconComponent:"atto_yukaltura",buttonName:"recorder",title:"recorder_button_title",callback:this._displayRecorder,callbackArgs:"recorder"})))},_getMediaControlName:function(){return this.get("host").get("elementid")+"_yukaltura_media"},_displaySelector:function(e,t){var a;e.preventDefault(),"700px"!==(e=this.getDialogue({headerContent:M.util.get_string("form_title",l),width:"700px",height:"720px",focusAfterHide:t})).width&&e.set("width","700px"),"720px"!==e.height&&e.set("height","720px"),t=this._getFormContent("selectorurl"),(a=f.Node.create('<div id="selector_'+r+'" name="selector_'+r+'"></div>')).append(t),e.set("bodyContent",a),e.show(),this.markUpdated()},_displayUploader:function(e,t){var a;e.preventDefault(),"700px"!==(e=this.getDialogue({headerContent:M.util.get_string("form_title",l),width:"700px",height:"720px",focusAfterHide:t})).width&&e.set("width","700px"),"720px"!==e.height&&e.set("height","720px"),t=this._getFormContent("uploaderurl"),(a=f.Node.create('<div id="uploader_'+r+'" name="uploader_'+r+'"></div>')).append(t),e.set("bodyContent",a),e.show(),this.markUpdated()},_displayRecorder:function(e,t){var a;e.preventDefault(),"700px"!==(e=this.getDialogue({headerContent:M.util.get_string("form_title",l),width:"700px",height:"720px",focusAfterHide:t})).width&&e.set("width","700px"),"720px"!==e.height&&e.set("height","720px"),t=this._getFormContent("recorderurl"),(a=f.Node.create('<div id="recorder_'+r+'" name="recorder_'+r+'"></div>')).append(t),e.set("bodyContent",a),e.show(),this.markUpdated()},_getFormContent:function(e){var t=f.Handlebars.compile('<iframe src="{{url}}" width="680px" height="580px" name="yukaltura_frame" id="yukaltura_frame_{{elementid}}"></iframe><div align="right"><input type="button" class="{{CSS.INPUTSUBMIT}}" id="{{CSS.INPUTSUBMIT}}" name="{{CSS.INPUTSUBMIT}}" value={{get_string "insert" component}}>&nbsp;<input type="button" class="{{CSS.INPUTCANCEL}}" id="{{CSS.INPUTCANCEL}}" name="{{CSS.INPUTCANCEL}}" value={{get_string "cancel" component}}></div><input type="hidden" id="select_id" name="select_id" value="">'),e=f.Node.create(t({elementid:this.get("host").get("elementid"),CSS:a,component:l,url:this.get(e)}));return r=this.get("host").get("elementid"),this._form=e,this._form.one("."+a.INPUTSUBMIT).on("click",this._doInsert,this),this._form.one("."+a.INPUTCANCEL).on("click",this._doCancel,this),e},_doInsert:function(e){var t,a,l,r,i,s,h,o,u,c,n,d,_,p,m,g;e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),this.editor.focus(),null!==f.one("#yukaltura_select_id")&&(e=f.one("#yukaltura_select_id").get("value"),t=f.one("#yukaltura_select_name").get("value"),a=f.one("#yukaltura_host").get("value"),l=f.one("#yukaltura_partnerid").get("value"),r=f.one("#yukaltura_uiconfid").get("value"),i=f.one("#yukaltura_width").get("value"),s=f.one("#yukaltura_height").get("value"),h=f.one("#yukaltura_playerstudio").get("value"),d=f.one("#yukaltura_filetype").get("value"),o=f.one("#yukaltura_naturalwidth").get("value"),u=f.one("#yukaltura_naturalheight").get("value"),c=(new Date).getTime(),n="",null!==e&&""!==e&&null!==a&&""!==a&&null!==l&&""!==l&&null!==r&&""!==r&&null!==i&&""!==i&&null!==s&&""!==s&&null!==h&&""!==h&&(n="image"==d&&0<o&&0<u?(d=a+"/p/"+l+"/sp/"+l+"00/thumbnail/entry_id/",d+=e+"/def_height/"+u+"/def_width/"+o+"/type/1",p=_=0,640<o||480<u?(n=(n+='<a href="'+d+'" target="_new">')+'<img src="'+(a+"/p/"+l+"/sp/"+l+("00/thumbnail/entry_id/"+e+"/def_height/"+(p=(g=u/480)<=(m=o/640)?(_=Math.floor(o/m),Math.floor(u/m)):(_=Math.floor(o/g),Math.floor(u/g))))+("/def_width/"+_+"/type/1"))+'" width="'+_+'" height="'+p)+'" alt="'+t+'" title="'+t+'" border="0" /></a>':(n+='<img src="'+d)+'" width="'+o+'" height="'+u+'" alt="'+t+'" title="'+t+'" border="0" />'):"ovp"==h?(n=n+'<iframe type="text/javascript" src="'+a+"/p/"+l+"/embedPlaykitJs/uiconf_id/"+r+"?")+"iframeembed=true&entry_id="+e+'" style="width: '+i+"px; height: "+s+'px" allowfullscreen webkitallowfullscreen mozAllowFullScreen frameborder="0" allow="encrypted-media"></iframe>':(n=(n+='<iframe src="'+a+"/p/"+l+"/sp/"+l+"00/")+"embedIframeJs/uiconf_id/"+r+"/partner_id/"+l+"?iframeembed=true&playerId=kaltura_player_"+c+"&entry_id="+e)+'" width="'+i+'" height="'+s+'" allowfullscreen webkitallowfullscreen mozAllowFullScreen frameborder="0" allow="encrypted-media"></iframe>',this.get("host").insertContentAtFocusPoint(n),this.markUpdated())),this._removeParameters()},_doCancel:function(e){e.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),this.editor.focus(),this._removeParameters()},_removeParameters:function(){f.all("#yukaltura_select_id").remove(),f.all("#yukaltura_select_name").remove(),f.all("#yukaltura_host").remove(),f.all("#yukaltura_partnerid").remove(),f.all("#yukaltura_uiconfid").remove(),f.all("#yukaltura_playerstudio").remove(),f.all("#yukaltura_width").remove(),f.all("#yukaltura_height").remove(),f.all("#yukaltura_filetype").remove(),f.all("#yukaltura_naturalwidth").remove(),f.all("#yukaltura_naturalheight").remove()}},{ATTRS:{disabled:{value:!1},usercontextid:{value:null},selectorurl:{value:""},uploaderurl:{value:""},recorderurl:{value:""},enablemymedia:{value:0},enableuploading:{value:0},enablerecording:{value:0
}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});