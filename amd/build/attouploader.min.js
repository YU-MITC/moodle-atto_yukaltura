function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("atto_yukaltura/attouploader",["jquery"],function(a){return{init:function init(){var z="",A=0,B="",C=0,D=0,E={VIDEO:1,IMAGE:2,AUDIO:5},F={TRUE:1,FALSE:0,NULL:-1},G={ENTRY_IMPORTING:-2,ENTRY_CONVERTING:-1,ENTRY_IMPORT:0,ENTRY_PRECONVERT:1,ENTRY_READY:2,ENTRY_DELETED:3,ENTRY_PENDING:4,ENTRY_MODERATE:5,ENTRY_BLOCKED:6,ENTRY_NO_CONTENT:7},H={PENDING:0,PARTIAL_UPLOAD:1,FULL_UPLOAD:2,CLOSED:3,TIMED_OUT:4,DELETED:5},I=window.URL&&window.URL.createObjectURL?function(a){return window.URL.createObjectURL(a)}:window.webkitURL&&window.webkitURL.createObjectURL?function(a){return window.webkitURL.createObjectURL(a)}:void 0,J=window.URL&&window.URL.revokeObjectURL?function(a){return window.URL.revokeObjectURL(a)}:window.webkitURL&&window.webkitURL.revokeObjectURL?function(a){return window.webkitURL.revokeObjectURL(a)}:void 0;function b(){if(null===a("#fileData")||null===a("#fileData").files||""===a("#name").val()||""===a("#tags").val()||""===a("#type").val()||"N/A"===a("#type").val()){a("#entry_submit").prop("disabled",!0);a("#entry").val("")}else{a("#entry_submit").prop("disabled",!1)}}function c(){if(0>=A){return!1}if(2e9<A){return!1}return!0}function d(a){if(-1!=a.indexOf("video/avi")||-1!=a.indexOf("video/x-msvideo")||-1!=a.indexOf("video/mpeg")||-1!=a.indexOf("video/mpg")||-1!=a.indexOf("video/mp4")||-1!=a.indexOf("video/ogg")||-1!=a.indexOf("video/quicktime")||-1!=a.indexOf("video/VP8")||-1!=a.indexOf("video/x-flv")||-1!=a.indexOf("video/x-f4v")||-1!=a.indexOf("video/x-matroska")||-1!=a.indexOf("video/x-ms-wmv")||-1!=a.indexOf("video/webm")){return"video"}if(-1!=a.indexOf("audio/ac3")||-1!=a.indexOf("audio/ogg")||-1!=a.indexOf("audio/mpeg")||-1!=a.indexOf("audio/mp4")||-1!=a.indexOf("audio/mp3")||-1!=a.indexOf("audio/wav")||-1!=a.indexOf("audio/x-ms-wma")){return"audio"}if(-1!=a.indexOf("image/gif")||-1!=a.indexOf("image/jpeg")||-1!=a.indexOf("image/png")||-1!=a.indexOf("image/tiff")){return"image"}return"N/A"}function e(){var e="";if(a("#fileData")){var f=a("#fileData").prop("files")[0];A=parseInt(f.size);var g=d(encodeURI(f.type)),h=c();require(["core/str","core/notification"],function(b,c){b.get_strings([{key:"wrong_filesize",component:"local_yumymedia"},{key:"unsupported_filetype",component:"local_yumymedia"},{key:"filesize",component:"local_yumymedia"},{key:"mimetype",component:"local_yumymedia"}]).then(function(b){if(!1===h){e+=b[0]}if("N/A"==g){e+=b[1]}if(""!==e){window.alert(e);a("#file_info").html("");a("#name").val("");a("#tags").val("");a("#description").val("");a("#type").val("");a("#fileData").val("");C=0;D=0;B=""}else{var c="",d="",i=0;z=f.name;if(A>1073741824){i=A/1073741824;d=i.toFixed(2)+" G"}else if(A>1048576){i=A/1048576;d=i.toFixed(2)+" M"}else if(1024<A){i=A/1024;d=i.toFixed(2)+" k"}else{d=A+" "}c+="<div id=metadata_fields>";c+=b[2]+": "+d+"bytes<br>";c+=b[3]+":"+encodeURI(f.type)+"<br>";c+="</div><hr>";a("#file_info").html(c);a("#name").val(z);a("#type").val(g)}return 0}).fail(c.exception);return 0});if("image"==g){var i=new Image;i.onload=function(){C=i.naturalWidth;D=i.naturalHeight;J(i.src);window.console.log(C);window.console.log(D)};i.src=I(f)}else{C=0;D=0}B=g}b()}function f(){a("#file_info").html("");a("#type").val("");B="";C=0;D=0}function g(a){if(!0===/["$%&'~^\\`/]/.test(a)){return!1}else{return!0}}function h(a){if(!0===/[!"#$%&'~|^\\@`()[\]{}:;+*/=<>?]/.test(a)){return!1}else{return!0}}function i(){var b=a("#name").val(),c=a("#tags").val(),d=a("#description").val(),e=!0;if(!1===g(b)){require(["core/str"],function(b){var c=b.get_string("wrong_name","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})});e=!1}if(!1===h(c)){require(["core/str"],function(b){var c=b.get_string("wrong_tags","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})});e=!1}if(!1===g(d)){require(["core/str"],function(b){var c=b.get_string("wrong_desc","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})});e=!1}return e}function j(){if(!1===i()){return!1}if(!1===c()){require(["core/str"],function(b){var c=b.get_string("wrong_filesize","local_yumymedia",null);a.when(c).done(function(a){window.alert(a)})});return!1}a("#entry_submit").prop("disabled",!0);t();return!0}function k(){var b=a("#kalturahost").val();a.ajax({type:"GET",url:b+"/api_v3/service/session/action/end",cache:!1}).done(function(a){if(null===a){window.console.log("Cannot delete the uploadToken ! (Cannot get a XML response.)")}else{window.console.log("Kaltura Session has been deleted.")}}).fail(function(a){window.console.log("Cannot delete the uploadToken ! (Cannot connect to content server.)");if(null!==a){window.console.dir(a)}})}function l(b,c,d){if(""!==c&&""!==d){u()}a("#upload_info").html("");a("#upload_info").append("<font color=\"red\">"+b+"</font><br>");q();r()}function m(b,c,d,e,f){require(["core/str","core/notification"],function(g,h){g.get_strings([{key:"upload_success",component:"local_yumymedia"},{key:"entryid_header",component:"local_yumymedia"},{key:"name_header",component:"local_yumymedia"},{key:"tags_header",component:"local_yumymedia"},{key:"desc_header",component:"local_yumymedia"},{key:"creatorid_header",component:"local_yumymedia"},{key:"insert_media",component:"atto_yukaltura"}]).then(function(g){var h="<h3>"+g[0]+"</h3>";h+="<table border=\"2\" cellpadding=\"5\">";h+="<tr><td>"+g[1]+"</td><td>"+b+"</td></tr>";h+="<tr><td>"+g[2]+"</td><td>"+c+"</td></tr>";h+="<tr><td>"+g[3]+"</td><td>"+d+"</td></tr>";h+="<tr><td>"+g[4]+"</td><td>"+e+"</td></tr>";h+="<tr><td>"+g[5]+"</td><td>"+f+"</td></tr>";h+="</table>";h+="<br>";h+="<p><font color=\"red\">"+g[6]+"</font></p>";a("#upload_info").html(h);return 0}).fail(h.exception)});p();r()}function n(){if(null===parent.document.getElementById("yukaltura_select_id")||null===parent.document.getElementById("yukaltura_select_id")[0]){var b=a("body",parent.document),c="<input type=\"hidden\" name=\"yukaltura_select_id\" id=\"yukaltura_select_id\" value=\"\">";b.append(c);c="<input type=\"hidden\" name=\"yukaltura_select_name\" id=\"yukaltura_select_name\" value=\"\">";b.append(c);var d=a("#kalturahost").val();c="<input type=\"hidden\" name=\"yukaltura_host\" id=\"yukaltura_host\" value=\"";c=c+d+"\">";b.append(c);var e=a("#partnerid").val();c="<input type=\"hidden\" name=\"yukaltura_partnerid\" id=\"yukaltura_partnerid\" value=\"";c=c+e+"\">";b.append(c);var f=a("#uiconfid").val();c="<input type=\"hidden\" name=\"yukaltura_uiconfid\" id=\"yukaltura_uiconfid\" value=\"";c=c+f+"\">";b.append(c);var g=a("#player_width").val();c="<input type=\"hidden\" name=\"yukaltura_width\" id=\"yukaltura_width\" value=\""+g+"\">";b.append(c);var h=a("#player_height").val();c="<input type=\"hidden\" name=\"yukaltura_height\" id=\"yukaltura_height\" value=\""+h+"\">";b.append(c);var i=a("#player_studio").val();c="<input type=\"hidden\" name=\"yukaltura_playerstudio\" id=\"yukaltura_playerstudio\" value=\""+i+"\">";b.append(c);c="<input type=\"hidden\" name=\"yukaltura_filetype\" id=\"yukaltura_filetype\" value=\"";c+=B+"\">";b.append(c);c="<input type=\"hidden\" name=\"yukaltura_filetype\" id=\"yukaltura_filetype\" value=\"\">";b.append(c);c="<input type=\"hidden\" name=\"yukaltura_naturalwidth\" id=\"yukaltura_naturalwidth\" value=\"\">";b.append(c);c="<input type=\"hidden\" name=\"yukaltura_naturalheight\" id=\"yukaltura_naturalheight\" value=\"\">";b.append(c)}}function o(b,c){if(null!==b&&""!==b&&null!==parent.document.getElementById("yukaltura_select_id")&&null!==parent.document.getElementById("yukaltura_select_id")[0]){a("#yukaltura_select_id",parent.document).val(b);a("#yukaltura_select_name",parent.document).val(c);a("#yukaltura_filetype",parent.document).val(B);a("#yukaltura_naturalwidth",parent.document).val(C);a("#yukaltura_naturalheight",parent.document).val(D)}}function p(){a("#yukaltura_insert_btn",parent.document).prop("disabled",!1);a("#yukaltura_insert_btn",parent.document).css({opacity:"1.0"})}function q(){a("#yukaltura_insert_btn",parent.document).prop("disabled",!0);a("#yukaltura_insert_btn",parent.document).css({opacity:"0.5"})}function r(){a("#yukaltura_cancel_btn",parent.document).prop("disabled",!1);a("#yukaltura_cancel_btn",parent.document).css({opacity:"1.0"})}function s(){a("#yukaltura_cancel_btn",parent.document).prop("disabled",!0);a("#yukaltura_cancel_btn",parent.document).css({opacity:"0.5"})}function t(){var b=a("#kalturahost").val(),c=a("#ks").val();q();s();n();v(b,c)}function u(b,c,d){var e=new FormData,f;e.append("action","delete");e.append("ks",c);e.append("uploadTokenId",d);a.ajax(b+"/api_v3/service/uploadToken/action/delete",{type:"POST",data:e,cache:!1,contentType:!1,scriptCharset:"utf-8",processData:!1,async:!0,dataType:"xml"}).done(function(a){if(null===a){f=!1}f=!0}).fail(function(a){f=!1;if(null!==a){window.console.dir(a)}});return f}function v(b,c){var d,e,f=a("#fileData").prop("files")[0];A=parseInt(encodeURI(f.size));var g=b+"/api_v3/service/uploadToken/action/add?ks="+c;g=g+"&uploadToken:objectType=KalturaUploadToken";g=g+"uploadToken:fileName="+encodeURI(z);g=g+"&uploadToken:fileSize="+A;g=g+"&uploadToken:autoFinalize="+F.NULL;a.ajax(g,{type:"GET",cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",dataType:"xml"}).done(function(f){if(null===f){l("Cannot create upload token !<br>(Cannot get a XML response.)");return}e=a(f).find("code");if(null!==e&&_typeof(e)!==void 0&&""!==e.text()){l("Cannot create upload token !<br>("+e.text()+")");return}e=a(f).find("status");if(null===e||_typeof(e)===void 0||""===e.text()){l("Cannot create upload token !<br>(Cannot get status of upload token.)");return}var g=e.text();if(g!=H.PENDING){l("Cannot create upload token !<br>(UPLOAD_TOKEN_STATUS : "+g+")");return}e=a(f).find("id");if(null===e||_typeof(e)===void 0||""===e.text()){l("Cannot create uplaod token !<br>(Cannot get an uploadTokenId.)");return}d=e.text();setTimeout(function(){w(b,c,d)},50)}).fail(function(a){if(null!==a){window.console.dir(a)}l("Cannot create upload token !<br>(Cannot connect to kaltura server.)")})}function w(b,c,d){var e,f,g="",h="",i="",j="",k="",m=a("#name").val(),n=a("#tags").val(),o=a("#description").val(),p=a("#controlId").val(),q=a("#creatorId").val();m=m.trim();n=n.trim();if(null!==o){o=o.trim()}var r=new FormData;r.append("action","add");r.append("ks",c);r.append("entry:objectType","KalturaMediaEntry");var s=a("#type").val(),t="";if("image"==s){t=E.IMAGE}else if("audio"==s){t=E.AUDIO}else{t=E.VIDEO}r.append("entry:mediaType",t);r.append("entry:sourceType",1);r.append("entry:name",m);r.append("entry:tags",n);if(null!==o&&""!==o){r.append("entry:description",o)}else{r.append("entry:description","")}r.append("entry:categories",a("#categories").val());if(null!==p&&""!==p){r.append("entry:accessControlId",p)}r.append("entry:creatorId",q);r.append("entry:userId",q);a.ajax(b+"/api_v3/service/media/action/add",{type:"POST",data:r,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"}).done(function(m){if(null===m||_typeof(m)===void 0){u(b,c,d);l("Cannot create media entry !<br>(Cannot get a XML response.)");return}e=a(m).find("code");if(null!==e&&_typeof(e)!==void 0&&""!==e.text()){u(b,c,d);l("Cannot create media entry !<br>("+e.text()+")");return}e=a(m).find("status");if(null===e||_typeof(e)===void 0||""===e.text()){u(b,c,d);l("Cannot create media entyry !<br>(Cannot get a mediaEntryStatus.)");return}f=e.text();if(f!=G.ENTRY_NO_CONTENT){u(b,c,d);l("Cannot create media entry!<br>(mediaEntryStatus: "+f+")");return}e=a(m).find("id");g=e.text();e=a(m).find("name");h=e.text();e=a(m).find("tags");i=e.text();e=a(m).find("description");if(null!==e&&_typeof(e)!==void 0&&""!==e.text()){j=e.text()}else{j=""}e=a(m).find("creatorId");k=e.text();if(null===g||""===g||null===h||""===h||null===i||""===i||null===k||""===k||""!==o&&(null===j||""===j)){u(b,c,d);l("There exists wrong information(s) <br>");return}setTimeout(function(){x(b,c,d,g)},50)}).fail(function(a){if(null!==a){window.console.dir(a)}u(b,c,d);l("Cannot create media entry !<br>(Cannot connect to kaltura server.)")})}function x(b,c,d,e){var f,g=new FormData;g.append("action","upload");g.append("ks",c);g.append("uploadTokenId",d);g.append("fileData",a("input[name='fileData']").prop("files")[0],encodeURI(z),A);g.append("resume",!1);g.append("finalChunk",!0);g.append("resumeAt",0);a("#upload_info").html("");require(["core/str"],function(b){var c=b.get_string("uploader_uploading","local_yumymedia",null);a.when(c).done(function(b){a("#upload_info").append(b+"<br>")})});require(["core/str"],function(b){var c=b.get_string("progress","local_yumymedia",null);a.when(c).done(function(b){var c="<p>"+b;c=c+": <span id=\"pvalue\" style=\"color:#00b200\">0.00</span> %</p>";a("#upload_info").append(c)})});a.ajax(b+"/api_v3/service/uploadToken/action/upload",{type:"POST",data:g,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml",xhr:function xhr(){var b=a.ajaxSettings.xhr();if(b.upload){b.upload.addEventListener("progress",function(b){var c=parseInt(100*(b.loaded/b.total));a("#pvalue").html(parseInt(c))},!1)}return b}}).done(function(g){if(null===g){u(b,c,d);l("Cannot upload the video !<br>(Cannot get a XML response.)");return}f=a(g).find("code");if(null!==f&&_typeof(f)!==void 0&&""!==f.text()){u(b,c,d);l("Cannot upload the video !<br>("+f.text()+")");return}f=a(g).find("status");if(null===f||_typeof(f)===void 0||""===f.text()){u(b,c,d);l("Cannot upload the video !<br>(Cannot get an uploadTokenStatus.)");return}var h=f.text();if(h!=H.FULL_UPLOAD&&h!=H.PARTIAL_UPLOAD){u(b,c,d);l("Cannot upload the video !<br>(UPLOAD_TOKEN_STATUS : "+h+")");return}else{window.console.log("File chunk have been transmitted.")}require(["core/str"],function(b){var c=b.get_string("attach_file","local_yumymedia",null);a.when(c).done(function(b){a("#upload_info").append(b+"<br>")})});setTimeout(function(){y(b,c,d,e)},1e3)}).fail(function(a){if(null!==a){window.console.dir(a)}u(b,c,d);l("Cannot upload the file !<br>(Cannot connect to contents server.)")})}function y(b,c,d,e){var f,g="",h="",i="",j="",k,n=new FormData;n.append("action","addContent");n.append("ks",c);n.append("entryId",e);n.append("resource:objectType","KalturaUploadedFileTokenResource");n.append("resource:token",d);a.ajax(b+"/api_v3/service/media/action/addContent",{type:"POST",data:n,cache:!1,async:!0,contentType:!1,scriptCharset:"utf-8",processData:!1,dataType:"xml"}).done(function(n){if(null===n||_typeof(n)===void 0){u(b,c,d);l("Cannot attach uploaded file !<br>(Cannot get a XML response.)");return}k=a(n).find("code");if(null!==k&&_typeof(k)!==void 0&&""!==k.text()){u(b,c,d);l("Cannot attach uploaded file !<br>("+k.text()+")");return}k=a(n).find("status");if(null===k||_typeof(k)===void 0||""===k.text()){u(b,c,d);l("Cannot attach uploaded file !<br>(Cannot get a mediaEntryStatus.)");return}f=k.text();if(f!=G.ENTRY_READY&&f!=G.ENTRY_PENDING&&f!=G.ENTRY_PRECONVERT&&f!=G.IMPORT&&f!=G.IMPORTING){u(b,c,d);l("Cannot attach uploaded file !<br>(mediaEntryStatus: "+f+")");return}k=a(n).find("id");e=k.text();k=a(n).find("name");g=k.text();k=a(n).find("tags");h=k.text();k=a(n).find("description");if(null!==k&&_typeof(k)!==void 0&&""!==k.text()){i=k.text()}else{i=""}k=a(n).find("creatorId");j=k.text();m(e,g,h,i,j);o(e,g)}).fail(function(a){if(null!==a){window.console.dir(a)}u(b,c,d);l("Cannot attach uploaded file !<br>(Cannot connect to kaltura server.)")})}a(window).on("change",function(){b()});a(window).on("unload",function(){k()});a("#fileData").on("change",function(){e()});a("#name").on("change",function(){b()});a("#tags").on("change",function(){b()});a("#entry_submit").on("click",function(){j()});a("#entry_reset").on("click",function(){f()});(function(){a("#yukaltura_select_id",parent.document).remove();a("#yukaltura_select_name",parent.document).remove();a("#yukaltura_host",parent.document).remove();a("#yukaltura_partnerid",parent.document).remove();a("#yukaltura_uiconfid",parent.document).remove();a("#yukaltura_playerstudio",parent.document).remove();a("#yukaltura_width",parent.document).remove();a("#yukaltura_height",parent.document).remove();a("#yukaltura_filetype",parent.document).remove();a("#yukaltura_naturalwidth",parent.document).remove();a("#yukaltura_naturalheight",parent.document).remove()})();q();r()}}});
//# sourceMappingURL=attouploader.min.js.map
